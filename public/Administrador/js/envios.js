const btonNotificar=document.getElementById("notificar");
let csrf = document.getElementById("csrf").value;
btonNotificar.addEventListener("click", (e)=>{
    e.preventDefault();
    EnvioNotificacionDescuentos();
})

const EnvioNotificacionDescuentos=()=>{
    let url="/Administrador/notificaciones";  
    fetch(url)
    .then(response=>response.json())
    .then(data=>{
        let msgNotificaciones=document.getElementById("msgNoti");
        msgNotificaciones.innerHTML+=`<div  style="display: none">
        <div id="correoMensaje">
        <center style="min-width:580px;width:100%"> <table style="Margin:0 auto;border-collapse:collapse;border-spacing:0;float:none;margin:0 auto;padding:0;text-align:center;vertical-align:top;width:100%"> <tbody> <tr style="padding:0;text-align:left;vertical-align:top"> <td height="15px" style="Margin:0;border-collapse:collapse!important;color:#322f37;font-family:Helvetica,Arial,sans-serif;font-size:10px;font-weight:400;line-height:10px;margin:0;padding:0;text-align:left;vertical-align:top;word-wrap:break-word">&nbsp;</td></tr></tbody> </table> <table align="center" class="m_-3617184912195535673container" style="Margin:0 auto;background:#fff;border-collapse:collapse;border-spacing:0;float:none;margin:0 auto;padding:10px;text-align:center;vertical-align:top;width:580px;margin-left:10px!important;margin-right:10px!important"> <tbody> <tr style="padding:0;text-align:left;vertical-align:top"> <td style="Margin:0;border-collapse:collapse!important;color:#322f37;font-family:Helvetica,Arial,sans-serif;font-size:16px;font-weight:400;line-height:1.3;margin:0;padding:0;text-align:left;vertical-align:top;word-wrap:break-word"> <table class="m_-3617184912195535673row m_-3617184912195535673header-v2" style="background-color:#fff;background-image:none;background-position:top left;background-repeat:repeat;border-bottom:1px solid #efeef1;border-collapse:collapse;border-spacing:0;display:table;margin:10px 0 15px 0;padding:0;text-align:left;vertical-align:top;width:100%"> <tbody> <tr style="padding:0;text-align:left;vertical-align:top"> <th class="m_-3617184912195535673small-12 m_-3617184912195535673columns" style="Margin:0 auto;color:#322f37;font-family:Helvetica,Arial,sans-serif;font-size:16px;font-weight:400;line-height:1.3;margin:0 auto;padding:0;padding-bottom:0!important;padding-left:20px;padding-right:20px;padding-top:0!important;text-align:left;width:560px"> <table style="border-collapse:collapse;border-spacing:0;padding:0;text-align:left;vertical-align:top;width:100%"> <tbody> <tr style="padding:0;text-align:left;vertical-align:top"> <th style="Margin:0;color:#322f37;font-family:Helvetica,Arial,sans-serif;font-size:16px;font-weight:400;line-height:1.3;margin:0;padding:0;text-align:left"> <h1 style="text-align: center; ">AXES SKATEBOARDING</h1> <hr style="height:3px;border:none;background:linear-gradient(274deg, #46c9d0d8, #6262e2d2 44%, #c862f7d8)"> </th> </tbody> </table> </th> </tr></tbody> </table> <table class="m_-3617184912195535673row" style="border-collapse:collapse;border-spacing:0;display:table;padding:0;text-align:left;vertical-align:top;width:100%"> <tbody> <tr style="padding:0;text-align:left;vertical-align:top"> <th class="m_-3617184912195535673small-12 m_-3617184912195535673columns" style="Margin:0 auto;color:#322f37;font-family:Helvetica,Arial,sans-serif;font-size:18px;font-weight:500;line-height:1.3;margin:0 auto;padding:0;padding-bottom:0!important;padding-left:20px;padding-right:20px;padding-top:0!important;text-align:left;width:560px"> <table style="border-collapse:collapse;border-spacing:0;padding:0;text-align:left;vertical-align:top;width:100%"> <tbody> <tr style="padding:0;text-align:left;vertical-align:top"> <th style="Margin:0;color:#322f37;font-family:Helvetica,Arial,sans-serif;font-size:18px;font-weight:500;line-height:1.3;margin:0;padding:0;text-align:left"> <h6 style="Margin:0;Margin-bottom:10px;color:inherit;font-family:Helvetica,Arial,sans-serif;font-size:18px;font-weight:500;line-height:1.3;margin:0;margin-bottom:0;padding:0;padding-bottom:0;text-align:center;word-wrap:normal;color:#9147ff">Conoce nuestros descuentos.</h6> </th> <th style="Margin:0;color:#322f37;font-family:Helvetica,Arial,sans-serif;font-size:16px;font-weight:400;line-height:1.3;margin:0;padding:0!important;text-align:left;width:0"> </th> </tr></tbody> </table> </th> </tr></tbody> </table> <table class="m_-3617184912195535673row" style="border-collapse:collapse;border-spacing:0;display:table;padding:0;text-align:left;vertical-align:top;width:100%"> <tbody> <tr style="padding:0;text-align:left;vertical-align:top"> <th class="m_-3617184912195535673small-12 m_-3617184912195535673columns" style="Margin:0 auto;color:#322f37;font-family:Helvetica,Arial,sans-serif;font-size:16px;font-weight:300;line-height:1.3;margin:0 auto;padding:0;padding-bottom:16px;padding-left:20px;padding-right:20px;padding-top:10px;text-align:left;width:560px"> <table style="border-collapse:collapse;border-spacing:0;padding:0;text-align:left;vertical-align:top;width:100%"> <tbody> <tr style="padding:0;text-align:left;vertical-align:top"> <th style="Margin:0;color:#322f37;font-family:Helvetica,Arial,sans-serif;font-size:16px;font-weight:400;line-height:1.3;margin:0;padding:0;text-align:left"> <p style="Margin:0;Margin-bottom:10px;font-family:Helvetica,Arial,Verdana,font-size:16px;font-weight:300;line-height:24px;margin:0;margin-bottom:0;padding:0;padding-bottom:0;text-align:justify"> Este es un correo generado automaticamente. <br><br>Hola a todos, es un gusto para nosotros tenerte en nuesta tienda <strong>AXES SKATEBOARDING</strong>, te queremos mostrar todos los descuentos de nuestros productos.<br><br>Tenemos los siguientes productos con descuento: <br><br><con> <div id="productosDescuentos"></div>No te pierdas esta oportunidad y realiza tu compra ahora! <br>Siempre a la orden, <strong>AXES SKATEBOARDING</strong>! <br><br></p><p style="Margin:0;Margin-bottom:10px;font-family:Helvetica,Arial,Verdana,font-size:16px;font-weight:300;line-height:24px;margin:0;margin-bottom:0;padding:0;padding-bottom:0;text-align:justify"> Click aqui para ir a nuestra pagina web y ver la seccion de descuentos. <br><br><br><a style="text-decoration:none; font-weight:600; font-size:20px; color:#000000; padding-top:15px; padding-bottom:15px; padding-left:150px; padding-right:150px; background-color:#F69DA1;" href="http://127.0.0.1:8000/Descuentos">Mostrar Descuentos</a> </p><br><br><hr style="height:3px;border:none;background:linear-gradient(274deg, #46c9d0d8, #6262e2d2 44%, #c862f7d8)"> </th> <th style="Margin:0;color:#322f37;font-family:Helvetica,Arial,sans-serif;font-size:14px;font-weight:400;line-height:1.3;margin:0;padding:0!important;text-align:left;width:0"> </th> </tr></tbody> </table> </th> </tr></tbody> </table> </td></tr></tbody> </table> <table align="center" class="m_-3617184912195535673container" style="Margin:0 auto;background:0 0!important;border-collapse:collapse;border-spacing:0;float:none;margin:0 auto;padding:0;text-align:center;vertical-align:top;width:580px"> <table align="center" style="background:0 0!important;border-collapse:collapse;border-spacing:0;margin:20px auto 0 auto;padding:0;text-align:inherit;vertical-align:top;width:580px"> <tbody> <tr> <th> <table style="border-collapse:collapse;border-spacing:0;display:table;padding:0;text-align:left;vertical-align:top;width:100%"> <tbody> <tr style="padding:0;text-align:left;vertical-align:top"> <th style="Margin:0 auto;color:#322f37;font-family:Helvetica,Arial,sans-serif;font-size:16px;font-weight:400;line-height:1.3;margin:0 auto;padding:0;padding-bottom:0!important;padding-left:20px;padding-right:10px;padding-top:0!important;text-align:left;width:270px"> <a href="https://www.instagram.com/axes_sb/?hl=es-la" style="Margin:0;color:#9147ff;font-family:Helvetica,Arial,sans-serif;font-weight:400;line-height:1.3;margin:0;padding:0;text-align:left;text-decoration:none" target="_blank" data-saferedirecturl="https://www.google.com/url?q=https://twitter.com/twitch/&amp;source=gmail&amp;ust=1619220556159000&amp;usg=AFQjCNEug20xhrAM9lzwNhIQFUKt-Iuyyw"> <img src="https://ci4.googleusercontent.com/proxy/XHffVu34DLJFd5BgnT-FmR1sO6U8aNYtqIngRIAczxlyKN1dB0Fe-00F3bXbo3fVQ4PlEIpJVQrCAsfuBto15Y4neEJHUxd2v0z7gy41unT3YDbJg6bTUgmWOcju7HCKeL18r1pH8A=s0-d-e1-ft#https://s.jtvnw.net/jtv_user_pictures/hosted_images/email-instagram-logo-20171115.png" width="20" height="20" alt="twitch-twitter" style="border:none;clear:both;display:block;float:right;max-width:100%;outline:0;text-align:right;text-decoration:none;width:auto" class="CToWUd"></a> </th> <th style="Margin:0 auto;color:#322f37;font-family:Helvetica,Arial,sans-serif;font-size:16px;font-weight:400;line-height:1.3;margin:0 auto;padding:0;padding-bottom:0!important;padding-left:10px;padding-right:20px;padding-top:0!important;text-align:left;width:270px"><a href="https://www.facebook.com/AXES-Skateboarding-100422468179966" style="Margin:0;color:#9147ff;font-family:Helvetica,Arial,sans-serif;font-weight:400;line-height:1.3;margin:0;padding:0;text-align:left;text-decoration:none" target="_blank" data-saferedirecturl="https://www.google.com/url?q=https://www.facebook.com/twitch/&amp;source=gmail&amp;ust=1619220556159000&amp;usg=AFQjCNG3o1VhrjDfvgSdkK5emCCumBWZEw"> <img src="https://ci4.googleusercontent.com/proxy/XHffVu34DLJFd5BgnT-FmR1sO6U8aNYtqIngRIAczxlyKN1dB0Fe-00F3bXbo3fVQ4PlEIpJVQrCAsfuBto15Y4neEJHUxd2v0z7gy41unT3YDbJg6bTUgmWOcju7HCKeL18r1pH8A=s0-d-e1-ft#https://s.jtvnw.net/jtv_user_pictures/hosted_images/email-facebook-logo-20171115.png" width="20" height="20" alt="twitch-facebook" style="border:none;clear:both;display:block;float:left;max-width:100%;outline:0;text-align:left;text-decoration:none;width:auto" class="CToWUd"></a> </th> </tr></tbody> </table> </th> </tr><tr style="padding:0;vertical-align:top"> <th style="color:#322f37;font-family:Helvetica,Arial,sans-serif;font-size:16px;font-weight:400;line-height:1.3;margin:0;padding:0"> <p style="color:#322f37;font-family:Helvetica,Arial,Verdana,font-size:16px;font-weight:400;line-height:24px;margin:0;margin-top:5px;margin-bottom:10px;padding:0;padding-bottom:10px;text-align:center"> <small style="color:#706a7c;font-size:14px">© 2021 AXES SKATEBOARDING, todos los derechos reservados</small> </p></th> <th style="color:#322f37;font-family:Helvetica,Arial,sans-serif;font-size:16px;font-weight:400;line-height:1.3;margin:0;padding:0!important;text-align:left;width:0"></th> </tr></tbody> </table> </table> </center></div> </div>`;
        let productosEmail=document.getElementById("productosDescuentos");
        data.forEach(element => {
              valor=element.descuento.substring(2)
            if( valor[0]=== "0"){
                productosEmail.innerHTML+=`
                ${element.nombre} con un descuento del <strong> ${element.descuento.substring(3,4)}</strong>%<br><br> 
                `;  
            }else{
            productosEmail.innerHTML+=`
            ${element.nombre} con un descuento del <strong> ${element.descuento.substring(2,4)}</strong>%<br><br> 
            `;    
            } 
        });
      let mensaje=document.getElementById("correoMensaje").outerHTML; 
      let data2=new URLSearchParams();
      console.log(mensaje)
      
   
      data2.append("mensaje",mensaje);
       fetch('/Administrador/notificaciones',{
            headers:{
                'X-CSRF-TOKEN':csrf    
            },
            body : data2,
            method: "POST"
       })
       .then(response=>response.json())
       .then(compa=>{
           if(compa == 1){
                Swal.fire({
                    icon : "success",
                    title : "Envio exitoso",
                    text : "Hemos enviado un correo a nuestros usuarios notificando en los descuentos de tus productos"
                })
           }
       })
    })
    .catch(error=>console.log(error))
}

